(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1115:function(e,a,t){"use strict";t.r(a),t.d(a,"default",function(){return y});t(5),t(4),t(15),t(8),t(74),t(136),t(55);var n=t(0),r=t.n(n),c=t(28),o=t(63),s=t(16),i=t(515),l=t(748),u=t(17),m=t(11),p=t.n(m),d=t(21);function f(e){return(f="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,a){return function(e){if(Array.isArray(e))return e}(e)||function(e,a){var t=[],n=!0,r=!1,c=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(t.push(o.value),!a||t.length!==a);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw c}}return t}(e,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function b(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,a){return(_=Object.setPrototypeOf||function(e,a){return e.__proto__=a,e})(e,a)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var y=function(e){function a(e){var t,n,r;return function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,a),n=this,(t=!(r=v(a).call(this,e))||"object"!==f(r)&&"function"!==typeof r?E(n):r).inputChange=t.inputChange.bind(E(E(t))),t.confirmOrder=t.confirmOrder.bind(E(E(t))),t.preCalculatePrice=t.preCalculatePrice.bind(E(E(t))),t.goAddress=t.goAddress.bind(E(E(t))),t.state={is_show_point:!1,is_show_coupon:!1,course:null,addressInfo:null,user:null,calPrice:null,coupon_no:"",coupon_msg:"",point:"",point_msg:"",remark:"",orderedLessonsOrders:[]},t}var t,m,y;return function(e,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&_(e,a)}(a,n["Component"]),t=a,(m=[{key:"componentDidMount",value:function(){var e=this;document.title="\u7ed3\u7b97\u4e2d\u5fc3";var a=Object(c.b)().cid;Object(d.b)(p.a.APIURL_Order_Prepare,{cid:a}).then(function(a){var t=h(a,2),n=t[0],r=t[1];if(n)return alert(Object(o.a)(n));var c=r.is_show_point,s=r.is_show_coupon,i=r.lesson,l=r.user,u=r.calPrice,m=r.orderedLessonsOrders,p=r.addressInfo,d={is_show_point:c,is_show_coupon:s,course:i,user:l,calPrice:u,orderedLessonsOrders:m};u.point_discount&&(d.point=u.point_discount),u.coupon_no&&(d.coupon_no=u.coupon_no),p&&(d.addressInfo={name:p.name,phone:p.phone,address:p.area.replace(/-/g,"").replace(/-\u5e02\u8f96\u533a-/,"")+p.address}),e.setState(d,function(){(u.point_discount||u.coupon_no)&&e.preCalculatePrice()})})}},{key:"inputChange",value:function(e){var a=this,t=e.target,n=t.name,r=t.value;"point"===n&&r&&!/^(\d|\.)+$/.test(r)||this.setState(function(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}({},n,r),function(){a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){a.preCalculatePrice()},300)})}},{key:"preCalculatePrice",value:function(){var e=this,a=this.state,t=a.point,n=a.coupon_no;Object(d.b)(p.a.APIURL_Order_PreCalculatePrice,{cid:Object(c.b)().cid,point:t,coupon_no:n}).then(function(a){var t=h(a,2),n=t[0],r=t[1];e.hasError(n)||e.setState(function(e){return{calPrice:Object.assign(e.calPrice,r)}})})}},{key:"goAddress",value:function(){var e=encodeURIComponent(location.href);location.href="/address?case=1&redirect=".concat(e)}},{key:"confirmOrder",value:function(){var e=this,a=Object(c.b)().cid,t=this.state,n=t.coupon_no,r=t.point,o=t.remark,s=t.course,i=t.addressInfo,l={cid:a,coupon_no:n,point:r,remark:o};if("1"===s.is_need_remark){if(!i)return void alert("\u8bf7\u586b\u5199\u8be6\u7ec6\u5730\u5740");l.addressInfo=i}Object(d.b)(p.a.APIURL_Order_Create,l).then(function(a){var t=h(a,2),n=t[0],r=t[1];if(!e.hasError(n)){var c=r.order_id;location.href="/pay/center?cid=".concat(c)}})}},{key:"hasError",value:function(e){return e?(-1!==e.indexOf("point")?this.setState({point_msg:Object(o.a)(e)}):this.setState({point_msg:""}),-1!==e.indexOf("coupon")?this.setState({coupon_msg:Object(o.a)(e)}):this.setState({coupon_msg:""}),-1!==e.indexOf("coupon")||-1!==e.indexOf("point")||alert(Object(o.a)(e))):(this.setState({point_msg:"",coupon_msg:""}),!1)}},{key:"renderPackageLesson",value:function(){var e=this.state.course;return e&&e.packages&&e.packages.length?r.a.createElement("div",{className:"package"},e.packages.map(function(e,a){return r.a.createElement("div",{className:"item",key:a},r.a.createElement("span",{className:"title"},e.name),r.a.createElement("span",{className:"price"},"\uffe5",e.price))})):null}},{key:"renderOrderedLessons",value:function(){var e=this.state.orderedLessonsOrders;return e&&e.length?r.a.createElement("div",{className:"ordered-package"},e.map(function(e,a){return r.a.createElement("div",{className:"item",key:a},r.a.createElement("span",{className:"title"},e.subject,"\uff08\u5df2\u8d2d\uff09"))})):null}},{key:"render",value:function(){var e=this.state,a=e.is_show_point,t=e.is_show_coupon,n=e.course,c=e.addressInfo,o=e.user,m=e.calPrice,p=e.coupon_no,d=e.coupon_msg,f=e.point,h=e.point_msg;return r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,{isShow:!u.a.inAPP()&&!s.a.wechat()}),r.a.createElement("div",{className:"container-fluid course-container-bg"},r.a.createElement("div",{className:"prepare-container"},r.a.createElement("div",{className:"brief"},r.a.createElement("div",{className:"image"},r.a.createElement("div",{className:"content",style:n&&n.img?{background:"url(".concat(n.img?"//www.bstcine.com/f/"+n.img:"",") center center / cover no-repeat")}:null})),r.a.createElement("div",{className:"right"},r.a.createElement("div",{className:"title"},n&&n.name?n.name:""),r.a.createElement("div",{className:"prices"},n&&n.price?r.a.createElement("span",{className:"price"},"\uffe5",n.price):null,n&&n.original_price?r.a.createElement("span",{className:"old-price"},"\u539f\u4ef7\uff1a",r.a.createElement("span",{className:"del"},"\uffe5",n.original_price)):null))),this.renderPackageLesson(),r.a.createElement("div",{className:"order-control total-price"},r.a.createElement("span",{className:"label"},"\u5e94\u4ed8\u91d1\u989d"),m&&m.price?r.a.createElement("span",{className:"price"},"\uffe5",m.price):null),this.renderOrderedLessons(),t?r.a.createElement("div",{className:"order-control coupon"},r.a.createElement("span",{className:"label"},"\u4f18\u60e0\u5238"),r.a.createElement("div",{className:"input"},r.a.createElement("span",{className:"normal"},"\u8f93\u5165\u4f18\u60e0\u5238"),r.a.createElement("input",{name:"coupon_no",value:p,className:d?"err":"",onChange:this.inputChange}),r.a.createElement("span",{className:"error-tips"},d),r.a.createElement("span",{className:"red"},"\u62b5\u6263\uff1a-\uffe5",m.coupon_discount))):null,a&&o&&m?r.a.createElement("div",{className:"order-control point"},r.a.createElement("span",{className:"label"},"\u79ef\u5206"),r.a.createElement("span",{className:"red"},o.point),r.a.createElement("div",{className:"input"},r.a.createElement("span",{className:"normal"},"\u672c\u6b21\u4f7f\u7528"),r.a.createElement("input",{name:"point",value:f,className:h?"err":"",onChange:this.inputChange}),r.a.createElement("span",{className:"normal"},"\u79ef\u5206"),r.a.createElement("span",{className:"error-tips"},h),r.a.createElement("span",{className:"red"},"\u62b5\u6263\uff1a-\uffe5",m.point_discount))):null,r.a.createElement("div",{className:"order-control pay-price"},r.a.createElement("span",{className:"label"},"\u5b9e\u4ed8\u91d1\u989d"),m&&m.pay_price?r.a.createElement("span",{className:"price"},"\uffe5",m.pay_price):null),n&&"1"===n.is_need_remark?r.a.createElement("div",{className:"order-control address"},r.a.createElement("span",{className:"label"},"\u6536\u8d27\u5730\u5740"),r.a.createElement("button",{className:"btn-outline",onClick:this.goAddress},c?"\u4fee\u6539\u5730\u5740":"\u6dfb\u52a0\u5730\u5740"),c?r.a.createElement("div",{className:"my-address"},r.a.createElement("div",{className:"my-address-contact"},r.a.createElement("span",null,"\u6536\u8d27\u4eba\uff1a"),r.a.createElement("span",{className:"my-name"},c.name),r.a.createElement("span",null,c.phone)),r.a.createElement("div",{className:"my-area"},r.a.createElement("span",null,"\u5730\u5740\uff1a"),r.a.createElement("span",null,c.address))):null):null,n&&"1"===n.is_need_remark?r.a.createElement("div",{className:"order-control remark"},r.a.createElement("span",{className:"label"},"\u5907\u6ce8"),r.a.createElement("div",{className:"my-remark"},r.a.createElement("textarea",{name:"remark",value:this.state.remark,onChange:this.inputChange,rows:"4"}))):null,r.a.createElement("button",{className:"btn-action btn-confirm",onClick:this.confirmOrder},"\u63d0\u4ea4\u8ba2\u5355"))),r.a.createElement(l.a,{isShow:!s.a.mobile()}))}}])&&b(t.prototype,m),y&&b(t,y),a}()}}]);